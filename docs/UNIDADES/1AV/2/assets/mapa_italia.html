<!doctype html>
<html lang="gl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mapa · Expansión e Imperio Romano</title>

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        crossorigin>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>

  <style>
    html, body { height:100%; margin:0; }
    #map { height:100%; width:100%; }
    .leaflet-popup-content h3 { margin:.2rem 0; font-size:16px; }
    .leaflet-popup-content small { color:#555; }
    .legend {
      background:#fff; padding:.6rem .8rem; border-radius:.5rem;
      box-shadow:0 2px 6px rgba(0,0,0,.1);
      font:12px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    }
    .legend h4 { margin:0 0 .3rem; font-size:13px; }
    .legend .row { display:flex; align-items:center; gap:.4rem; margin:.15rem 0; }
    .legend .dot {
      width:12px; height:12px; border-radius:50%;
      display:inline-block; border:1px solid #00000022;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <script>
    // --- Mapa ---
    const map = L.map('map').setView([41.9, 12.5], 5);

    const base = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      {maxZoom:19, attribution:'&copy; OpenStreetMap contribuidores'}).addTo(map);

    // --- Cores por período ---
    const colorMonarquia = '#b91c1c';
    const colorRepublica = '#dc2626';
    const colorImperio = '#ea580c';
    const colorProvincias = '#16a34a';

    // --- Capas ---
    const capaMonarquia = L.layerGroup();
    const capaRepublica = L.layerGroup();
    const capaImperio = L.layerGroup();
    const capaProvincias = L.layerGroup();

    // --- Helper ---
    function addCity(layer, coords, title, html, color) {
      const marker = L.circleMarker(coords,{
        radius:6, color, weight:2, fillColor:color, fillOpacity:.85
      }).addTo(layer);
      marker.bindPopup(html,{maxWidth:320});
      return marker;
    }

    // --- Núcleo inicial ---
    addCity(capaMonarquia,[41.89,12.49],"Roma",
      `<h3>Roma</h3><small>753–509 a.n.e.</small>
       <p>Fundación lendaria por Rómulo; sete colinas; influencias etruscas.</p>`,
       colorMonarquia);

    addCity(capaMonarquia,[42.42,11.14],"Veios",
      `<h3>Veios</h3><small>Cidade etrusca</small>
       <p>Rival inicial de Roma; conquistada no 396 a.n.e. (Cámilo).</p>`,
       colorMonarquia);

    // --- Expansión republicana ---
    addCity(capaRepublica,[41.65,14.25],"Samnio",
      `<h3>Guerras samnitas</h3>
       <p>Conflitos polo control da península italiana (s. IV–III a.n.e.).</p>`,
       colorRepublica);

    addCity(capaRepublica,[37.22,14.76],"Siracusa",
      `<h3>Siracusa</h3>
       <p>Aliada e rival sucesiva; conquista romana en 212 a.n.e.</p>`,
       colorRepublica);

    addCity(capaRepublica,[36.86,10.33],"Cartago",
      `<h3>Cartago</h3>
       <p><strong>Guerras Púnicas</strong> (264–146 a.n.e.): dominio do Mediterráneo occidental.</p>`,
       colorRepublica);

    addCity(capaRepublica,[41.39,2.17],"Emporion",
      `<h3>Emporion (Empúries)</h3>
       <p>Desembarco romano na II Guerra Púnica (218 a.n.e.).</p>`,
       colorRepublica);

    // --- Imperio ---
    addCity(capaImperio,[48.85,2.35],"Lutetia (París)",
      `<h3>Lutetia</h3>
       <p>Romanización da Galia (s. I a.C.–I d.C.).</p>`,
       colorImperio);

    addCity(capaImperio,[52.52,13.4],"Colonia (Germania)",
      `<h3>Colonia Agrippina</h3>
       <p>Fronteira do Rin; presenza militar e comercial.</p>`,
       colorImperio);

    addCity(capaImperio,[30.05,31.23],"Alexandria",
      `<h3>Alexandría</h3>
       <p>Integrada no Imperio tras a conquista de Exipto (30 a.n.e.).</p>`,
       colorImperio);

    addCity(capaImperio,[41.01,28.96],"Constantinopla",
      `<h3>Constantinopla</h3>
       <small>Fundada 330 d.C.</small>
       <p>Nova capital do Imperio; ponte entre Europa e Asia.</p>`,
       colorImperio);

    // --- Provincias ---
    addCity(capaProvincias,[38.7,-9.13],"Olisipo (Lisboa)",
      `<h3>Olisipo</h3><small>Provincia Lusitania</small>
       <p>Romanización da fachada atlántica (s. I a.C.).</p>`,
       colorProvincias);

    addCity(capaProvincias,[43.36,-8.41],"Brigantium (A Coruña)",
      `<h3>Brigantium</h3><small>Finis Terrae</small>
       <p>Fronteira norte-occidental do Imperio.</p>`,
       colorProvincias);

    addCity(capaProvincias,[41.9,12.5],"Roma (capital)",
      `<h3>Roma</h3><p>Centro político, relixioso e cultural do Imperio.</p>`,
      colorImperio);

    // --- Engadir capas ---
    capaMonarquia.addTo(map);
    capaRepublica.addTo(map);
    capaImperio.addTo(map);
    capaProvincias.addTo(map);

    const overlays = {
      'Monarquía (753–509 a.n.e.)': capaMonarquia,
      'República (509–27 a.n.e.)': capaRepublica,
      'Imperio (27 a.n.e.–476 d.C.)': capaImperio,
      'Provincias e romanización': capaProvincias
    };

    L.control.layers(null,overlays,{collapsed:true}).addTo(map);

    // --- Lenda ---
    const legend = L.control({position:'bottomleft'});
    legend.onAdd = function() {
      const div = L.DomUtil.create('div','legend');
      div.innerHTML = `
        <h4>Expansión romana</h4>
        <div class="row"><span class="dot" style="background:${colorMonarquia}"></span> Monarquía</div>
        <div class="row"><span class="dot" style="background:${colorRepublica}"></span> República</div>
        <div class="row"><span class="dot" style="background:${colorImperio}"></span> Imperio</div>
        <div class="row"><span class="dot" style="background:${colorProvincias}"></span> Provincias</div>
      `;
      return div;
    };
    legend.addTo(map);

    // --- Axustar vista ---
    const all = L.featureGroup([
      ...capaMonarquia.getLayers(),
      ...capaRepublica.getLayers(),
      ...capaImperio.getLayers(),
      ...capaProvincias.getLayers()
    ]);
    map.fitBounds(all.getBounds().pad(0.15));

    L.control.scale({metric:true,imperial:false}).addTo(map);
  </script>
</body>
</html>
